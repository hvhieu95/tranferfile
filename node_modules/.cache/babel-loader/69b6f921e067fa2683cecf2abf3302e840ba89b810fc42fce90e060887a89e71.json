{"ast":null,"code":"var _jsxFileName = \"D:\\\\rikkei\\\\bearcle\\\\React Typescript\\\\react-ts-file\\\\src\\\\contexts\\\\DraggableContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useContext, useState, createContext, useRef, useEffect } from \"react\";\n\n// context cho tính năng kéo thả\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst defaultDraggableValue = {\n  positions: {},\n  handleStop: () => () => {},\n  handleStart: () => () => {},\n  canvasItems: [],\n  handleDropOnCanvas: (itemType, dropPosition) => {},\n  // ...\n  canvasRef: /*#__PURE__*/React.createRef()\n};\nconst DraggableContext = /*#__PURE__*/createContext(defaultDraggableValue);\n\n// custom hook để truy cập vào giá trị của Draggble context\nexport const useDraggble = () => {\n  _s();\n  return useContext(DraggableContext);\n};\n\n// component để chia sẻ logic và state liên quan tới kéo thả\n_s(useDraggble, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const DraggableProvider = ({\n  children\n}) => {\n  _s2();\n  const [canvasItems, setCanvasItems] = useState([]);\n  useEffect(() => {\n    console.log(\"canvasItems after update:\", canvasItems);\n  }, [canvasItems]);\n  const [positions, setPositions] = useState({\n    rectangle: {\n      x: 0,\n      y: 0\n    },\n    circle: {\n      x: 0,\n      y: 0\n    },\n    vector: {\n      x: 0,\n      y: 0\n    }\n  });\n  const initialPositionsRef = useRef({});\n  const canvasRef = useRef(null);\n  useEffect(() => {\n    if (!initialPositionsRef.current[\"rectangle\"]) {\n      initialPositionsRef.current[\"rectangle\"] = positions[\"rectangle\"];\n    }\n    if (!initialPositionsRef.current[\"circle\"]) {\n      initialPositionsRef.current[\"circle\"] = positions[\"circle\"];\n    }\n    if (!initialPositionsRef.current[\"vector\"]) {\n      initialPositionsRef.current[\"vector\"] = positions[\"vector\"];\n    }\n  }, [positions]);\n\n  // lưu vị trí ban đầu của hình\n  const handleStart = id => (e, data) => {\n    initialPositionsRef.current[id] = {\n      x: data.x,\n      y: data.y\n    };\n  };\n\n  // hàm xử lý khi việc kéo kết thúc\n  const handleStop = id => (e, data) => {\n    if (canvasRef.current) {\n      // kiểm tra vị trí của canvas và các hình\n      const canvasRect = canvasRef.current.getBoundingClientRect();\n      const itemRect = e.target.getBoundingClientRect();\n\n      // kiểm tra xem hình có nằm trong vùng canvas không\n      const isInsideCanvas = itemRect.left >= canvasRect.left && itemRect.right <= canvasRect.right && itemRect.top >= canvasRect.top && itemRect.bottom <= canvasRect.bottom;\n      if (!isInsideCanvas) {\n        setPositions(prevPositons => ({\n          ...prevPositons,\n          [id]: initialPositionsRef.current[id]\n        }));\n      } else {\n        setPositions(prevPositions => ({\n          ...prevPositions,\n          [id]: {\n            x: data.x,\n            y: data.y\n          }\n        }));\n        initialPositionsRef.current[id] = {\n          x: data.x,\n          y: data.y\n        };\n      }\n    }\n  };\n  const handleDropOnCanvas = (itemType, dropPosition) => {\n    setCanvasItems(prevItems => {\n      const newItem = {\n        type: itemType,\n        id: Date.now(),\n        position: dropPosition\n      };\n      return [...prevItems, newItem];\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(DraggableContext.Provider, {\n    value: {\n      positions,\n      handleStop,\n      handleStart,\n      handleDropOnCanvas,\n      canvasItems,\n      canvasRef\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 119,\n    columnNumber: 5\n  }, this);\n};\n_s2(DraggableProvider, \"6Xj18tW3x1NpZkIZhZDyvV8BmFY=\");\n_c = DraggableProvider;\nvar _c;\n$RefreshReg$(_c, \"DraggableProvider\");","map":{"version":3,"names":["React","useContext","useState","createContext","useRef","useEffect","jsxDEV","_jsxDEV","defaultDraggableValue","positions","handleStop","handleStart","canvasItems","handleDropOnCanvas","itemType","dropPosition","canvasRef","createRef","DraggableContext","useDraggble","_s","DraggableProvider","children","_s2","setCanvasItems","console","log","setPositions","rectangle","x","y","circle","vector","initialPositionsRef","current","id","e","data","canvasRect","getBoundingClientRect","itemRect","target","isInsideCanvas","left","right","top","bottom","prevPositons","prevPositions","prevItems","newItem","type","Date","now","position","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/rikkei/bearcle/React Typescript/react-ts-file/src/contexts/DraggableContext.tsx"],"sourcesContent":["\r\nimport React, {\r\n  useContext,\r\n  useState,\r\n  createContext,\r\n  useRef,\r\n  useEffect,\r\n} from \"react\";\r\nimport { DraggableData, DraggableEvent } from \"react-draggable\";\r\nimport {CanvasItem} from \"../components/Canvas\"\r\n// context cho tính năng kéo thả\r\ntype DraggableContextType = {\r\n  positions: { [key: string]: { x: number; y: number } };\r\n  handleStop: (id: string) => (e: DraggableEvent, data: DraggableData) => void;\r\n  handleStart: (id: string) => (e: DraggableEvent, data: DraggableData) => void;\r\n  handleDropOnCanvas: (itemType: string, dropPosition: { x: number; y: number }) => void;\r\n  canvasItems: CanvasItem[];\r\n  canvasRef: React.RefObject<HTMLDivElement>;\r\n};\r\nconst defaultDraggableValue: DraggableContextType = {\r\n  positions: {},\r\n  handleStop: () => () => {},\r\n  handleStart: () => () => {},\r\n  canvasItems: [],\r\n  handleDropOnCanvas: (itemType: string, dropPosition: { x: number; y: number }) => {},\r\n  // ...\r\n  canvasRef: React.createRef<HTMLDivElement>(),\r\n};\r\n\r\nconst DraggableContext = createContext<DraggableContextType>(\r\n  defaultDraggableValue\r\n);\r\n\r\n// custom hook để truy cập vào giá trị của Draggble context\r\nexport const useDraggble = () => {\r\n  return useContext(DraggableContext);\r\n};\r\n\r\n// component để chia sẻ logic và state liên quan tới kéo thả\r\ntype DraggableProviderProps = {\r\n  children: React.ReactNode;\r\n};\r\nexport const DraggableProvider = ({ children }: DraggableProviderProps) => {\r\n  const [canvasItems, setCanvasItems] = useState<\r\n    Array<{ type: string; id: number }>\r\n  >([]);\r\n  useEffect(() => {\r\n    console.log(\"canvasItems after update:\", canvasItems);\r\n}, [canvasItems]);\r\n  const [positions, setPositions] = useState<{\r\n    [key: string]: { x: number; y: number };\r\n  }>({\r\n    rectangle: { x: 0, y: 0 },\r\n    circle: { x: 0, y: 0 },\r\n    vector: { x: 0, y: 0 },\r\n  });\r\n  const initialPositionsRef = useRef<{\r\n    [key: string]: { x: number; y: number };\r\n  }>({});\r\n  const canvasRef = useRef<HTMLDivElement | null>(null);\r\n  useEffect(() => {\r\n    if (!initialPositionsRef.current[\"rectangle\"]) {\r\n      initialPositionsRef.current[\"rectangle\"] = positions[\"rectangle\"];\r\n    }\r\n\r\n    if (!initialPositionsRef.current[\"circle\"]) {\r\n      initialPositionsRef.current[\"circle\"] = positions[\"circle\"];\r\n    }\r\n    if (!initialPositionsRef.current[\"vector\"]) {\r\n      initialPositionsRef.current[\"vector\"] = positions[\"vector\"];\r\n    }\r\n  }, [positions]);\r\n\r\n  // lưu vị trí ban đầu của hình\r\n  const handleStart =\r\n    (id: string) => (e: DraggableEvent, data: DraggableData) => {\r\n      initialPositionsRef.current[id] = { x: data.x, y: data.y };\r\n    };\r\n\r\n  // hàm xử lý khi việc kéo kết thúc\r\n  const handleStop =\r\n    (id: string) => (e: DraggableEvent, data: DraggableData) => {\r\n      if (canvasRef.current) {\r\n        // kiểm tra vị trí của canvas và các hình\r\n        const canvasRect = canvasRef.current.getBoundingClientRect();\r\n        const itemRect = (e.target as HTMLElement).getBoundingClientRect();\r\n\r\n        // kiểm tra xem hình có nằm trong vùng canvas không\r\n        const isInsideCanvas =\r\n          itemRect.left >= canvasRect.left &&\r\n          itemRect.right <= canvasRect.right &&\r\n          itemRect.top >= canvasRect.top &&\r\n          itemRect.bottom <= canvasRect.bottom;\r\n        if (!isInsideCanvas) {\r\n          setPositions((prevPositons) => ({\r\n            ...prevPositons,\r\n            [id]: initialPositionsRef.current[id],\r\n          }));\r\n        } else {\r\n          setPositions((prevPositions) => ({\r\n            ...prevPositions,\r\n            [id]: { x: data.x, y: data.y },\r\n          }));\r\n          initialPositionsRef.current[id] = { x: data.x, y: data.y };\r\n        }\r\n      }\r\n    };\r\n    const handleDropOnCanvas = (itemType: string, dropPosition: { x: number, y: number }) => {\r\n      setCanvasItems((prevItems) => {\r\n        const newItem = { type: itemType, id: Date.now(), position: dropPosition };\r\n        return [...prevItems, newItem];\r\n      });\r\n    };\r\n    \r\n  \r\n\r\n\r\n  return (\r\n    <DraggableContext.Provider\r\n      value={{\r\n        positions,\r\n        handleStop,\r\n        handleStart,\r\n        handleDropOnCanvas,\r\n        canvasItems,\r\n        canvasRef,\r\n      }}\r\n    >\r\n      <div>{children}</div>\r\n    </DraggableContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}