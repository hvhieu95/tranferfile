{"ast":null,"code":"var _jsxFileName = \"D:\\\\rikkei\\\\bearcle\\\\React Typescript\\\\react-ts-file\\\\src\\\\components\\\\Canvas\\\\Canvas.tsx\",\n  _s = $RefreshSig$();\nimport { useDraggable } from \"../../contexts/DraggableContext\";\nimport { DraggableItem } from \"../Generals/DraggableItem\";\nimport Draggable from \"react-draggable\";\nimport { useState, useEffect } from \"react\";\nimport DocViewer, { DocViewerRenderers } from \"@cyntler/react-doc-viewer\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Canvas = () => {\n  _s();\n  const {\n    canvasItems: initialCanvasItems,\n    addItemToCanvas,\n    undoCanvasAction,\n    uri\n  } = useDraggable();\n  const [canvasItems, setCanvasItems] = useState(initialCanvasItems);\n  const [selectedShapeId, setSelectedShapeId] = useState(null);\n  // Xử lý khi thả hình vào Canvas\n  const handleDrop = e => {\n    e.preventDefault();\n    e.stopPropagation();\n    const type = e.dataTransfer.getData(\"type\");\n    const source = e.dataTransfer.getData(\"source\");\n    const canvasRect = e.currentTarget.getBoundingClientRect();\n    const position = {\n      x: e.clientX - canvasRect.left,\n      y: e.clientY - canvasRect.top\n    };\n    if (source === \"library\") {\n      addItemToCanvas({\n        type,\n        id: Date.now(),\n        isSelected: false\n      }, position);\n    }\n  };\n  // Cho phép kéo hình trên Canvas\n  const handleDragOver = e => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n  // Cập nhật vị trí của hình trên Canvas\n  const updateItemPosition = (id, newPosition) => {\n    setCanvasItems(prevItems => {\n      return prevItems.map(item => {\n        if (item.id === id) {\n          return {\n            ...item,\n            position: newPosition\n          };\n        }\n        return item;\n      });\n    });\n  };\n  // Cập nhật danh sách hình khi có thay đổi\n  useEffect(() => {\n    setCanvasItems(initialCanvasItems);\n  }, [initialCanvasItems]);\n  // Xử lý sự kiện nhấn phím\n  useEffect(() => {\n    const handleKeyDown = event => {\n      if (event.key === \"Delete\" && selectedShapeId !== null) {\n        setCanvasItems(prevItems => prevItems.filter(item => item.id !== selectedShapeId));\n        setSelectedShapeId(null);\n      }\n      if (event.ctrlKey && event.key === \"z\") {\n        undoCanvasAction();\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyDown);\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\n  }, [selectedShapeId, undoCanvasAction]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    onDrop: handleDrop,\n    onDragOver: handleDragOver,\n    onClick: () => setSelectedShapeId(null),\n    style: {\n      border: \"1px solid black\",\n      minHeight: \"900px\",\n      position: \"relative\"\n    },\n    children: [canvasItems.map(item => /*#__PURE__*/_jsxDEV(Draggable, {\n      position: {\n        x: item.position.x,\n        y: item.position.y\n      },\n      onStop: (e, data) => {\n        updateItemPosition(item.id, {\n          x: data.x,\n          y: data.y\n        });\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: e => {\n          e.stopPropagation();\n          setSelectedShapeId(item.id);\n        },\n        children: /*#__PURE__*/_jsxDEV(DraggableItem, {\n          type: item.type,\n          id: item.id,\n          isSelected: selectedShapeId === item.id,\n          style: {\n            position: \"absolute\"\n          },\n          text: item.text || \"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this)\n    }, item.id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: uri !== '' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pdf\",\n        style: {\n          height: \"600px\",\n          width: \"100%\",\n          overflow: 'hidden'\n        },\n        children: /*#__PURE__*/_jsxDEV(DocViewer, {\n          documents: [{\n            uri: uri,\n            fileType: uri.substring(uri.length - 6).split('.').pop(),\n            fileName: \"remote \" + uri.substring(uri.length - 6).split('.').pop() + \" file\"\n          }],\n          pluginRenderers: DocViewerRenderers,\n          theme: {\n            primary: \"#5296d8\",\n            secondary: \"#ffffff\",\n            tertiary: \"#5296d899\",\n            textPrimary: \"#ffffff\",\n            textSecondary: \"#5296d8\",\n            textTertiary: \"#00000099\",\n            disableThemeScrollbar: true\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 8\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, this);\n};\n_s(Canvas, \"SfweWeZK1WF5W2PD3Dn9+crGDtk=\", false, function () {\n  return [useDraggable];\n});\n_c = Canvas;\nvar _c;\n$RefreshReg$(_c, \"Canvas\");","map":{"version":3,"names":["useDraggable","DraggableItem","Draggable","useState","useEffect","DocViewer","DocViewerRenderers","jsxDEV","_jsxDEV","Canvas","_s","canvasItems","initialCanvasItems","addItemToCanvas","undoCanvasAction","uri","setCanvasItems","selectedShapeId","setSelectedShapeId","handleDrop","e","preventDefault","stopPropagation","type","dataTransfer","getData","source","canvasRect","currentTarget","getBoundingClientRect","position","x","clientX","left","y","clientY","top","id","Date","now","isSelected","handleDragOver","updateItemPosition","newPosition","prevItems","map","item","handleKeyDown","event","key","filter","ctrlKey","window","addEventListener","removeEventListener","onDrop","onDragOver","onClick","style","border","minHeight","children","onStop","data","text","fileName","_jsxFileName","lineNumber","columnNumber","className","height","width","overflow","documents","fileType","substring","length","split","pop","pluginRenderers","theme","primary","secondary","tertiary","textPrimary","textSecondary","textTertiary","disableThemeScrollbar","_c","$RefreshReg$"],"sources":["D:/rikkei/bearcle/React Typescript/react-ts-file/src/components/Canvas/Canvas.tsx"],"sourcesContent":["import { useDraggable } from \"../../contexts/DraggableContext\";\r\nimport { DraggableItem } from \"../Generals/DraggableItem\";\r\nimport { ShapeType } from \"../../contexts/DraggableContext\";\r\nimport Draggable from \"react-draggable\";\r\nimport { useState, useEffect } from \"react\";\r\nimport DocViewer, { DocViewerRenderers } from \"@cyntler/react-doc-viewer\";\r\n\r\n export const Canvas = () => {\r\n  const { canvasItems: initialCanvasItems, addItemToCanvas, undoCanvasAction, uri } = useDraggable();\r\n  const [canvasItems, setCanvasItems] = useState(initialCanvasItems);\r\n  const [selectedShapeId, setSelectedShapeId] = useState<number | null>(null);\r\n  // Xử lý khi thả hình vào Canvas\r\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const type = e.dataTransfer.getData(\"type\") as ShapeType;\r\n    const source = e.dataTransfer.getData(\"source\");\r\n    const canvasRect = e.currentTarget.getBoundingClientRect();\r\n    const position = {\r\n      x: e.clientX - canvasRect.left,\r\n      y: e.clientY - canvasRect.top,\r\n    };\r\n    if (source === \"library\") {\r\n      addItemToCanvas({ type, id: Date.now(), isSelected: false }, position);\r\n    }\r\n  };\r\n  // Cho phép kéo hình trên Canvas\r\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    \r\n  };\r\n  // Cập nhật vị trí của hình trên Canvas\r\n  const updateItemPosition = (\r\n    id: number,\r\n    newPosition: { x: number; y: number }\r\n  ) => {\r\n    setCanvasItems((prevItems) => {\r\n      return prevItems.map((item) => {\r\n        if (item.id === id) {\r\n          return { ...item, position: newPosition };\r\n        }\r\n        return item;\r\n      });\r\n    });\r\n  };\r\n  // Cập nhật danh sách hình khi có thay đổi\r\n  useEffect(() => {\r\n    setCanvasItems(initialCanvasItems);\r\n  }, [initialCanvasItems]);\r\n  // Xử lý sự kiện nhấn phím\r\n  useEffect(() => {\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (event.key === \"Delete\" && selectedShapeId !== null) {\r\n        setCanvasItems((prevItems) =>\r\n          prevItems.filter((item) => item.id !== selectedShapeId)\r\n        );\r\n        setSelectedShapeId(null);\r\n      }\r\n      if (event.ctrlKey && event.key === \"z\") {\r\n        undoCanvasAction();\r\n      }\r\n    };\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [selectedShapeId,undoCanvasAction]);\r\n\r\n  return (\r\n    \r\n    <div\r\n      onDrop={handleDrop}\r\n      onDragOver={handleDragOver}\r\n      onClick={() => setSelectedShapeId(null)}\r\n      style={{\r\n        border: \"1px solid black\",\r\n        minHeight: \"900px\",\r\n        position: \"relative\",\r\n      }}\r\n    >\r\n  \r\n      \r\n      {canvasItems.map((item) => (\r\n        <Draggable\r\n          key={item.id}\r\n          position={{ x: item.position.x, y: item.position.y }}\r\n          onStop={(e, data) => {\r\n            updateItemPosition(item.id, { x: data.x, y: data.y });\r\n          }}\r\n        >\r\n          <div\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              setSelectedShapeId(item.id);\r\n            }}\r\n          >\r\n            <DraggableItem\r\n              type={item.type}\r\n              id={item.id}\r\n              isSelected={selectedShapeId === item.id}\r\n              style={{ position: \"absolute\" }}\r\n              text={item.text || \"\"}\r\n            />\r\n          </div>\r\n        </Draggable>\r\n      ))}\r\n       <div>\r\n   {uri !=='' && (\r\n        <div className=\"pdf\" style={{height: \"600px\", width: \"100%\", overflow: 'hidden'}}>\r\n          <DocViewer \r\n            documents={[{ \r\n              uri: uri,\r\n              fileType: uri.substring(uri.length - 6).split('.').pop(),\r\n              fileName: \"remote \" + uri.substring(uri.length - 6).split('.').pop() + \" file\"\r\n            }]} \r\n            pluginRenderers={DocViewerRenderers}\r\n            theme={{\r\n              primary: \"#5296d8\",\r\n              secondary: \"#ffffff\",\r\n              tertiary: \"#5296d899\",\r\n              textPrimary: \"#ffffff\",\r\n              textSecondary: \"#5296d8\",\r\n              textTertiary: \"#00000099\",\r\n              disableThemeScrollbar: true,\r\n            }}\r\n          />\r\n        </div>\r\n      )}\r\n   </div>\r\n    </div>\r\n  );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}